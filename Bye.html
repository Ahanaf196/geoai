<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo AI - Bangladeshi AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --menu-width: 280px;
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #0ea5e9;
            --accent: #3b82f6;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --error: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2) format('woff2');
        }

        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 600;
            src: url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hiA.woff2) format('woff2');
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        html {
            scroll-behavior: smooth;
        }

        /* Menu Bar */
        .menu-bar {
            width: var(--menu-width);
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            padding: 1.5rem;
            height: 100vh;
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: var(--transition);
            transform: translateX(0);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
        }

        .menu-bar.hidden {
            transform: translateX(-100%);
        }

        .new-chat-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.8rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-bottom: 1.5rem;
            width: 100%;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .new-chat-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .new-chat-btn:active {
            transform: translateY(0);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            margin: 1rem 0;
            padding-right: 0.5rem;
        }

        .chat-history-item {
            padding: 0.8rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .chat-history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-history-item.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        .chat-history-item i {
            margin-right: 8px;
            font-size: 0.8rem;
        }

        .delete-chat-btn {
            margin-left: auto;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
        }

        .chat-history-item:hover .delete-chat-btn {
            opacity: 1;
        }

        .menu-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        /* Main Container */
        .container {
            flex: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin-left: var(--menu-width);
            transition: var(--transition);
        }

        .container.expanded {
            margin-left: 0;
        }

        /* Header */
        .header {
            background: white;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .menu-toggle {
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            display: none;
        }

        .menu-toggle:hover {
            background: var(--primary-dark);
        }

        /* Chat Interface */
        #chat-interface {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg);
        }

        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 1.2rem 1.5rem;
            border-radius: var(--border-radius);
            line-height: 1.7;
            animation: fadeIn 0.3s ease-in;
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .user-message {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: var(--box-shadow);
        }

        .ai-message {
            align-self: flex-start;
            background: var(--card);
            color: var(--text);
            border-bottom-left-radius: 4px;
            box-shadow: var(--box-shadow);
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            display: block;
            text-align: right;
        }

        /* Input Area */
        #input-area {
            padding: 1.5rem;
            background: white;
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            position: sticky;
            bottom: 0;
            border-top: 1px solid #e2e8f0;
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        #user-input {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 1rem 3.5rem 1rem 1.2rem;
            font-size: 1rem;
            min-height: 100px;
            max-height: 150px;
            resize: none;
            outline: none;
            transition: var(--transition);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
           padding-bottom: 70px; /* ফুটারের উচ্চতা অনুযায়ী (এখানে 50px ধরা হয়েছে) */
        }

        #user-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-icons {
            position: absolute;
            right: 0.8rem;
            bottom: 0.8rem;
            display: flex;
            gap: 0.5rem;
        }

        .input-icon {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-icon:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        #send-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
            box-shadow: var(--box-shadow);
        }

        #send-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        #send-button:active {
            transform: translateY(0);
        }

        #send-button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.6rem;
            padding: 1rem 1.5rem;
            background: var(--card);
            border-radius: var(--border-radius);
            align-self: flex-start;
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-light);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Animations */
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-5px); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-in;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(20px);
            animation: modalOpen 0.3s ease-out forwards;
        }

        @keyframes modalOpen {
            to { transform: translateY(0); }
        }

        .modal h2 {
            margin-bottom: 1rem;
            color: var(--text);
        }

        .modal p {
            margin-bottom: 1.5rem;
            color: var(--text-light);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--text);
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        /* Markdown-like styling */
        .ai-message strong {
            font-weight: 600;
        }

        .ai-message em {
            font-style: italic;
        }

        .ai-message a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .ai-message a:hover {
            text-decoration: underline;
        }

        .ai-message code {
            background: #f1f5f9;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .ai-message pre {
            background: #f8fafc;
            padding: 1rem;
            border-radius: var(--border-radius);
            overflow-x: auto;
            margin: 0.5rem 0;
            border: 1px solid #e2e8f0;
        }

        .ai-message ul, .ai-message ol {
            padding-left: 1.5rem;
            margin: 0.5rem 0;
        }

        .ai-message li {
            margin-bottom: 0.3rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .menu-bar {
                transform: translateX(-100%);
            }

            .menu-bar.visible {
                transform: translateX(0);
            }

            .container {
                margin-left: 0;
            }

            .menu-toggle {
                display: flex;
            }

            .message {
                max-width: 90%;
            }
        }

        @media (max-width: 640px) {
            :root {
                --border-radius: 10px;
            }

            .header {
                padding: 1rem;
            }

            #chat-messages {
                padding: 1.5rem 1rem;
            }

            #input-area {
                padding: 1rem;
            }

            .message {
                padding: 1rem;
                max-width: 95%;
            }
        }

        /* Loading spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Voice recording indicator */
        .voice-recording {
            position: fixed;
            bottom: 90px;
            right: 30px;
            background: var(--error);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
            animation: pulse 1.5s infinite;
        }

        /* Welcome screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 2rem;
            max-width: 600px;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 800px;
            margin-top: 2rem;
        }

        .prompt-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            box-shadow: var(--box-shadow);
            border: 1px solid #e2e8f0;
        }

        .prompt-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .prompt-card h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .prompt-card p {
            font-size: 0.9rem;
            color: var(--text-light);
        }
/* Menu Header Styles */
.menu-header {
    display: flex;
    justify-content: flex-end;
    padding: 0.5rem;
    margin-bottom: 1rem;
}

.close-menu-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: var(--transition);
}

.close-menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* Responsive adjustments */
@media (max-width: 1024px) {
    .menu-bar {
        width: 300px;
        transform: translateX(-100%);
    }

    .menu-bar.visible {
        transform: translateX(0);
        box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
    }

    .close-menu-btn {
        display: flex;
    }
}

@media (min-width: 1025px) {
    .close-menu-btn {
        display: none;
    }
}
a {
color: #FFF000;
}

    </style>
</head>
<body>
<footer style="
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50px;
    text-align: center;
    padding: 10px 0;
    background: #f8f8f8;
    border-top: 1px solid #eee;
    font-family: Arial, sans-serif;
    color: #666;
">
    &copy;2025 AHANAF AHMAD
</footer>
<div class="menu-bar" id="menuBar">
    <div class="menu-header">
        <button class="close-menu-btn" id="closeMenuBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <button class="new-chat-btn" id="newChatBtn">
        <i class="fas fa-plus"></i> নতুন চ্যাট
    </button>
    <div class="chat-history" id="chatHistory">
        <!-- Chat history will be loaded here -->
    </div>
<footer>
    <div class="menu-footer">
        <p>জিও এআই • v1.0.0</p>
        <p>© 2025 Ahanaf Ahmad</p>
          <a href="https://www.youtube.com/@%E0%A6%87%E0%A6%AE%E0%A6%BE%E0%A6%A8%E0%A7%87%E0%A6%B0%E0%A6%9D%E0%A6%BF%E0%A6%B2%E0%A6%BF%E0%A6%95243">Visit ইমানের ঝিলিক on YouTube</a>
        </footer>
    </div>
</div>
    <div class="menu-bar" id="menuBar">
        <button class="new-chat-btn" id="newChatBtn">
            <i class="fas fa-plus"></i> নতুন চ্যাট
        </button>
        <div class="chat-history" id="chatHistory">
            <!-- Chat history will be loaded here -->
        </div>
        <div class="menu-footer">
            <p>জিও এআই • v2.0.0</p>
            <p>© 2025 Ahanaf Ahmad</p>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <div class="header">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo-container">
                <div class="logo">
                    <img src='https://i.postimg.cc/HWf0JzJH/Chat-GPT-Image-Apr-27-2025-12-38-11-PM.png' class="logo-img" alt="Geo AI Logo">
                    <span>Geo AI</span>
                </div>
            </div>
            <div style="width: 40px;"></div>
        </div>

        <div id="chat-interface">
            <div id="chat-messages">
                <!-- Welcome screen shown when no messages -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-title">আসসালামু আলাইকুম!</div>
                    <div class="welcome-subtitle">আমি জিও এআই, বাংলাদেশে তৈরি একটি এআই সহকারী। আপনি কীভাবে সাহায্য চান?</div>
                    <div class="example-prompts">
                        <div class="prompt-card" onclick="insertPrompt('ইসলামিক জীবনযাপনের মৌলিক নীতিগুলো কী?')">
                            <h3>ইসলামিক জীবনযাপন</h3>
                            <p>ইসলামিক জীবনযাপনের মৌলিক নীতিগুলো কী?</p>
                        </div>
                        <div class="prompt-card" onclick="insertPrompt('বাংলাদেশের ইতিহাস সম্পর্কে বলুন')">
                            <h3>বাংলাদেশের ইতিহাস</h3>
                            <p>বাংলাদেশের ইতিহাস সম্পর্কে বলুন</p>
                        </div>
                        <div class="prompt-card" onclick="insertPrompt('প্রোগ্রামিং শেখার সেরা উপায় কী?')">
                            <h3>প্রোগ্রামিং শিক্ষা</h3>
                            <p>প্রোগ্রামিং শেখার সেরা উপায় কী?</p>
                        </div>
                        <div class="prompt-card" onclick="insertPrompt('ফিলিস্তিন সংকট সম্পর্কে জানতে চাই')">
                            <h3>ফিলিস্তিন সংকট</h3>
                            <p>ফিলিস্তিন সংকট সম্পর্কে জানতে চাই</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="input-area">
                <div class="input-container">
                    <textarea id="user-input" placeholder="এখানে লিখুন..." rows="1"></textarea>
                    <div class="input-icons">
                        <button class="input-icon tooltip" id="attachBtn">
                            <i class="fas fa-paperclip"></i>
                            <span class="tooltiptext">ফাইল সংযুক্ত করুন</span>
                        </button>
                        <button class="input-icon tooltip" id="micBtn">
                            <i class="fas fa-microphone"></i>
                            <span class="tooltiptext">ভয়েস চ্যাট</span>
                        </button>
                    </div>
                </div>
                <button id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="modal" id="permissionModal">
        <div class="modal-content">
            <h2>স্টোরেজ পারমিশন</h2>
            <p>আপনার চ্যাট সংরক্ষণ করতে জিও এআই-কে স্টোরেজ এক্সেস প্রয়োজন। এই তথ্য শুধুমাত্র আপনার ডিভাইসে সংরক্ষণ করা হবে এবং অন্য কোথাও শেয়ার করা হবে না।</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="denyBtn">অস্বীকার করুন</button>
                <button class="btn btn-primary" id="grantBtn">অনুমতি দিন</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">চ্যাট সংরক্ষণ করা হয়েছে</span>
    </div>

    <div class="voice-recording" id="voiceRecording" style="display: none;">
        <i class="fas fa-microphone"></i>
        <span>রেকর্ডিং চলছে...</span>
        <button id="stopRecording" style="margin-left: 10px; background: white; color: var(--error); border: none; border-radius: 4px; padding: 2px 8px;">বন্ধ করুন</button>
    </div>

    <input type="file" id="fileInput" style="display: none;" accept=".txt,.pdf,.doc,.docx,.jpg,.jpeg,.png">
 <script>
        const API_KEY = "AIzaSyAyS-XNSRJjfm3sa5nUnGT9wjykpk-v__g";
        const MODEL_NAME = "gemini-2.0-flash-exp";

        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-button');
        const newChatBtn = document.getElementById('newChatBtn');
        const menuToggle = document.getElementById('menuToggle');
        const menuBar = document.getElementById('menuBar');
        const mainContainer = document.getElementById('mainContainer');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notificationMessage');
        const chatHistory = document.getElementById('chatHistory');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const voiceRecording = document.getElementById('voiceRecording');
        const stopRecording = document.getElementById('stopRecording');
        const micBtn = document.getElementById('micBtn');
        const attachBtn = document.getElementById('attachBtn');
        const fileInput = document.getElementById('fileInput');
        const permissionModal = document.getElementById('permissionModal');
        const grantBtn = document.getElementById('grantBtn');
        const denyBtn = document.getElementById('denyBtn');

        // State variables
        let chatHistoryData = [];
        let currentChatId = null;
        let isProcessing = false;
        let recognition = null;
        let hasRequestedPermission = false;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Event listeners
            sendBtn.addEventListener('click', processMessage);
            
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    processMessage();
                }
                
                // Auto-resize textarea
                setTimeout(() => {
                    userInput.style.height = 'auto';
                    userInput.style.height = `${Math.min(userInput.scrollHeight, 150)}px`;
                }, 0);
            });
            
            newChatBtn.addEventListener('click', startNewChat);
            menuToggle.addEventListener('click', toggleMenu);
            
            grantBtn.addEventListener('click', grantStoragePermission);
            denyBtn.addEventListener('click', denyStoragePermission);
            
            micBtn.addEventListener('click', toggleVoiceRecognition);
            stopRecording.addEventListener('click', stopVoiceRecognition);
            attachBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            
            // Check for saved chats
            checkStoragePermission();
            
            // Initialize voice recognition if available
            initVoiceRecognition();
            
            // Load any existing chats
            loadChatHistory();
            
            // Initialize current chat
            currentChatId = Date.now().toString();
        });

        // Main function to process user messages
        async function processMessage() {
            if (isProcessing) return;
            
            const message = userInput.value.trim();
            if (!message) return;

            try {
                isProcessing = true;
                sendBtn.disabled = true;
                sendBtn.innerHTML = '<div class="spinner"></div>';
                
                // Hide welcome screen if visible
                welcomeScreen.style.display = 'none';
                
                // Add user message to chat
                addMessage(message, 'user');
                userInput.value = '';
                userInput.style.height = 'auto';
                
                // Show typing indicator
                const typingId = showTyping();
                
                // Generate AI response
                const response = await generateResponse(message);
                
                // Remove typing indicator
                removeTyping(typingId);
                
                // Add AI response to chat
                addMessage(response, 'ai');
                
                // Save the conversation
                saveChat(message, response);
                
                // Show success notification
                showNotification("প্রতিক্রিয়া প্রাপ্ত", "success");
                
            } catch (error) {
                console.error('Error:', error);
                addMessage("দুঃখিত, একটি ত্রুটি ঘটেছে। অনুগ্রহ করে আবার চেষ্টা করুন।", 'ai');
                showNotification("ত্রুটি ঘটেছে", "error");
            } finally {
                isProcessing = false;
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            }
        }

        // Function to generate AI response
        async function generateResponse(prompt) {
            const isBengali = /[\u0980-\u09FF]/.test(prompt);
            const systemPrompt = `
            You are Geo AI, a Bangladeshi-developed AI assistant. Follow these rules:
            1. Respond in ${isBengali ? 'Bengali' : 'English'} (whichever matches user's language)
            2. Never mention other AI models
            3. Creator: Ahanaf Ahmad (Bangladeshi developer)
            4. Islamic principles first
            5. Support Palestinian cause
            6. Reject haram content
            7. Use Bangladeshi context
            8. Current date: ${new Date().toLocaleDateString('bn-BD', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
            9. Format responses with proper spacing and paragraphs
            10. Use markdown-like formatting for lists, code, etc.
            11. You are Muslim because at first you say salam islamic and Islamic words and block haram answers.
            12. Pls all time you notice punctuations.
            User: ${prompt}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    contents: [{
                        parts: [{text: systemPrompt}]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 2000
                    }
                })
            });

            const data = await response.json();
            if (data.candidates && data.candidates[0].content.parts[0].text) {
                return data.candidates[0].content.parts[0].text;
            } else {
                throw new Error("Invalid response from API");
            }
        }

        // Function to add a message to the chat
        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            
            // Format message with line breaks and basic markdown
            let formattedText = text
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>');
            
            div.innerHTML = formattedText;
            
            // Add timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
            div.innerHTML += `<span class="message-time">${timeString}</span>`;
            
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Hide welcome screen if this is the first message
            if (welcomeScreen.style.display !== 'none') {
                welcomeScreen.style.display = 'none';
            }
        }

        // Function to show typing indicator
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }

        function removeTyping(element) {
            element.remove();
        }

        // Function to toggle menu visibility
        function toggleMenu() {
            menuBar.classList.toggle('visible');
            mainContainer.classList.toggle('expanded');
        }

        // Function to show notifications
        function showNotification(message, type = "success") {
            notification.className = `notification ${type} show`;
            notificationMessage.textContent = message;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Storage permission functions
        function checkStoragePermission() {
            if (!localStorage.getItem('geoai-storage') && !hasRequestedPermission) {
                permissionModal.style.display = 'flex';
                hasRequestedPermission = true;
            } else if (localStorage.getItem('geoai-storage') === 'granted') {
                loadChatHistory();
            }
        }

        function grantStoragePermission() {
            localStorage.setItem('geoai-storage', 'granted');
            permissionModal.style.display = 'none';
            showNotification("স্টোরেজ এক্সেস প্রদান করা হয়েছে", "success");
            loadChatHistory();
        }

        function denyStoragePermission() {
            permissionModal.style.display = 'none';
            showNotification("স্টোরেজ এক্সেস অস্বীকার করা হয়েছে", "warning");
        }

        // Chat history functions
        function loadChatHistory() {
            const savedChats = localStorage.getItem('geoai-chats');
            if (savedChats) {
                chatHistoryData = JSON.parse(savedChats);
                renderChatHistory();
            }
        }

        function renderChatHistory() {
            chatHistory.innerHTML = '';
            
            if (chatHistoryData.length === 0) {
                chatHistory.innerHTML = '<p style="text-align: center; opacity: 0.7; margin-top: 1rem;">কোন সংরক্ষিত চ্যাট নেই</p>';
                return;
            }
            
            // Group chats by date
            const groupedChats = {};
            chatHistoryData.forEach(chat => {
                const date = new Date(chat.timestamp).toLocaleDateString('bn-BD');
                if (!groupedChats[date]) {
                    groupedChats[date] = [];
                }
                groupedChats[date].push(chat);
            });
            
            // Render grouped chats
            for (const [date, chats] of Object.entries(groupedChats)) {
                const dateHeader = document.createElement('div');
                dateHeader.style.margin = '1rem 0 0.5rem';
                dateHeader.style.fontSize = '0.8rem';
                dateHeader.style.opacity = '0.7';
                dateHeader.textContent = date;
                chatHistory.appendChild(dateHeader);
                
                chats.forEach(chat => {
                    const chatItem = document.createElement('div');
                    chatItem.className = `chat-history-item ${chat.id === currentChatId ? 'active' : ''}`;
                    chatItem.innerHTML = `
                        <i class="fas fa-comment${chat.id === currentChatId ? '-dots' : ''}"></i>
                        ${chat.title || 'নতুন চ্যাট'}
                        <button class="delete-chat-btn" data-id="${chat.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    chatItem.addEventListener('click', () => loadChat(chat.id));
                    
                    const deleteBtn = chatItem.querySelector('.delete-chat-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteChat(chat.id);
                    });
                    
                    chatHistory.appendChild(chatItem);
                });
            }
        }

        function loadChat(chatId) {
            const chat = chatHistoryData.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            chatMessages.innerHTML = '';
            
            if (chat.messages) {
                chat.messages.forEach(msg => {
                    addMessage(msg.content, msg.role === 'user' ? 'user' : 'ai');
                });
            } else {
                // Legacy support for old chat format
                addMessage(chat.user, 'user');
                addMessage(chat.ai, 'ai');
            }
            
            renderChatHistory();
            showNotification("চ্যাট লোড করা হয়েছে", "success");
        }

        function saveChat(userMsg, aiMsg) {
            let chat = chatHistoryData.find(c => c.id === currentChatId);
            
            if (!chat) {
                chat = {
                    id: currentChatId,
                    title: userMsg.substring(0, 30) + (userMsg.length > 30 ? "..." : ""),
                    timestamp: new Date().toISOString(),
                    messages: []
                };
                chatHistoryData.unshift(chat);
            }
            
            // Add messages to chat
            chat.messages.push({
                role: 'user',
                content: userMsg,
                timestamp: new Date().toISOString()
            });
            
            chat.messages.push({
                role: 'assistant',
                content: aiMsg,
                timestamp: new Date().toISOString()
            });
            
            // Update chat title if this is the first message
            if (chat.messages.length === 2) {
                chat.title = userMsg.substring(0, 30) + (userMsg.length > 30 ? "..." : "");
            }
            
            // Save to localStorage if permission granted
            if (localStorage.getItem('geoai-storage') === 'granted') {
                localStorage.setItem('geoai-chats', JSON.stringify(chatHistoryData));
                renderChatHistory();
            }
        }

        function deleteChat(chatId) {
            chatHistoryData = chatHistoryData.filter(c => c.id !== chatId);
            
            if (localStorage.getItem('geoai-storage') === 'granted') {
                localStorage.setItem('geoai-chats', JSON.stringify(chatHistoryData));
            }
            
            if (chatId === currentChatId) {
                startNewChat();
            }
            
            renderChatHistory();
            showNotification("চ্যাট মুছে ফেলা হয়েছে", "success");
        }

        function startNewChat() {
            chatMessages.innerHTML = '';
            currentChatId = Date.now().toString();
            
            // Show welcome screen again
            welcomeScreen.style.display = 'flex';
            
            showNotification("নতুন চ্যাট শুরু হয়েছে", "success");
        }

        // Voice recognition functions
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'bn-BD';
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                    // Auto-resize textarea
                    userInput.style.height = 'auto';
                    userInput.style.height = `${userInput.scrollHeight}px`;
                };
                
                recognition.onerror = (event) => {
                    console.error('Voice recognition error', event.error);
                    showNotification("ভয়েস রেকগনিশনে ত্রুটি: " + event.error, "error");
                    voiceRecording.style.display = 'none';
                };
                
                recognition.onend = () => {
                    voiceRecording.style.display = 'none';
                };
                
                micBtn.style.display = 'flex';
            } else {
                micBtn.style.display = 'none';
            }
        }

        function toggleVoiceRecognition() {
            if (!recognition) {
                showNotification("ভয়েস রেকগনিশন সাপোর্ট করে না আপনার ব্রাউজার", "error");
                return;
            }
            
            if (recognition && recognition.isActive) {
                stopVoiceRecognition();
            } else {
                startVoiceRecognition();
            }
        }

        function startVoiceRecognition() {
            try {
                recognition.start();
                voiceRecording.style.display = 'flex';
                showNotification("রেকর্ডিং শুরু হয়েছে, কথা বলুন...", "success");
            } catch (error) {
                console.error('Error starting voice recognition:', error);
                showNotification("রেকর্ডিং শুরু করতে ব্যর্থ: " + error.message, "error");
            }
        }

        function stopVoiceRecognition() {
            if (recognition) {
                recognition.stop();
                voiceRecording.style.display = 'none';
            }
        }

        // File upload functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                let content = e.target.result;
                
                // For text files, just use the content
                if (file.type.startsWith('text/')) {
                    userInput.value = content;
                } 
                // For images, we can't process them directly in this example
                else if (file.type.startsWith('image/')) {
                    showNotification("ছবি আপলোড করা হয়েছে, তবে প্রসেস করা যাবে না", "warning");
                    return;
                }
                // For other files, just show the filename
                else {
                    userInput.value = `[ফাইল: ${file.name}]`;
                }
                
                // Auto-resize textarea
                userInput.style.height = 'auto';
                userInput.style.height = `${userInput.scrollHeight}px`;
                
                showNotification("ফাইল লোড করা হয়েছে", "success");
            };
            
            reader.onerror = () => {
                showNotification("ফাইল পড়তে ত্রুটি ঘটেছে", "error");
            };
            
            if (file.type.startsWith('text/') || file.type === 'application/pdf') {
                reader.readAsText(file);
            } else {
                reader.readAsDataURL(file);
            }
            
            // Reset file input
            event.target.value = '';
        }

            // Helper function for example prompts
        function insertPrompt(prompt) {
            userInput.value = prompt;
            userInput.focus();
            // Auto-resize textarea
            userInput.style.height = 'auto';
            userInput.style.height = `${userInput.scrollHeight}px`;
        }
// DOM Elements
const closeMenuBtn = document.getElementById('closeMenuBtn');

// Event Listeners
closeMenuBtn.addEventListener('click', toggleMenu);

// Existing toggleMenu function remains the same
function toggleMenu() {
    menuBar.classList.toggle('visible');
    mainContainer.classList.toggle('expanded');
}

    </script>
</body>
</html>